
---
title: "R code For Intro to DS project:"
author: "Keerthana Aravindhan"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
editor_options: 
  markdown: 
    wrap: sentence
---


```{r init, include=F}
# The package "ezids" (EZ Intro to Data Science) includes some helper functions we developed for the course. 
# Some of the frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
# You will need to install it (once) from GitHub.
# library(devtools)
# devtools::install_github("physicsland/ezids")
# Then load the package in your R session.
library(ezids)
```

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(warning = F, message = F)
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

```{r code1}
df = data.frame(read.csv("D:/Keerthu/GW/IntroToDataScience_6101/Project/Data_sets/Food_Deserts_in_US.csv"))
head(df)
```

*Question 3.1 :*

 - Percentage of Group Quarters in Food desert regions:

```{r code2}
df$GroupQuartersFlag <- as.factor(df$GroupQuartersFlag)
df$LILATracts_1And10 <- as.factor(df$LILATracts_1And10)

#summary(df)

#results = data.frame()
#colnames(results) <- c('GroupQuarters_LILA', 'NonGroupQuarters_LILA')
GroupQuarters_LILA <- df[ (df$GroupQuartersFlag == 1 & df$LILATracts_1And10 == 1), c("GroupQuartersFlag", "LILATracts_1And10")]
NonGroupQuarters_LILA <- df[df$GroupQuartersFlag == 0 & df$LILATracts_1And10 == 1, c("GroupQuartersFlag", "LILATracts_1And10")]

data = data.frame()
Percentage_GroupQuarters_LILA = nrow(GroupQuarters_LILA)/(sum(nrow(GroupQuarters_LILA)+ nrow(NonGroupQuarters_LILA)))*100
Percentage_NonGroupQuarters_LILA = nrow(NonGroupQuarters_LILA)/(sum(nrow(GroupQuarters_LILA)+ nrow(NonGroupQuarters_LILA)))*100
data <- rbind(data, Percentage_GroupQuarters_LILA)
data <- rbind(data, Percentage_NonGroupQuarters_LILA)
GroupQuartersFlag = c(1,0)
data <- cbind(data, GroupQuartersFlag)
colnames(data) <- c('Percentage', 'GroupQuartersFlag')
head(data)
```

```{r code 3}
library(ggplot2)
pie_chart <- ggplot(data, aes(x = "", y = Percentage, fill = factor(GroupQuartersFlag))) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Percentage of Group quarters in Food desert regions",
       fill = "GroupQuartersFlag") +
  scale_fill_manual(values = c("0" = "grey", "1" = "black"), labels = c("0", "1")) +
  theme_minimal() +
  theme(legend.position = "bottom")
print(pie_chart)
```

 - Bar chart to compare the Group quarters in Urban and rural.

```{r }
df$GroupQuartersFlag <- as.factor(df$GroupQuartersFlag)
df$Urban <- as.factor(df$Urban)

GroupQuarters <- df[df$GroupQuartersFlag == 1, c("GroupQuartersFlag", "Urban")]

```

```{r}
bar_chart <- ggplot(GroupQuarters, aes(x = GroupQuartersFlag, fill = Urban)) +
  geom_bar(position = "dodge") +
  labs(title = "Comparison of GroupQuartersFlag and Urban Flag",
       x = "Group Quarters Flag",
       y = "Count") +
  scale_fill_manual(values = c("1" = "lightgreen", "0" = "magenta")) +
  theme_minimal()

print(bar_chart)
```


- T-Test to compare the "PovertyRate" between areas with and without group quarters:

  Null Hypothesis (H0): The average Poverty rate are the same for with and without group quarters .

  Alternative Hypothesis (H1): The average Poverty rate are different for with and without group quarters .

```{r}

df_outliers <- ezids::outlierKD2(df, PovertyRate, rm = TRUE, boxplt = TRUE, qqplt = TRUE)

GroupQuarters_Poverty <- df_outliers[df_outliers$GroupQuartersFlag == 1, c("GroupQuartersFlag", "PovertyRate")]
NonGroupQuarters_Poverty <- df_outliers[df_outliers$GroupQuartersFlag == 0, c("GroupQuartersFlag", "PovertyRate")]

```

```{r}

data2 = data.frame()
Percentage_GroupQuarters_Poverty = nrow(GroupQuarters_Poverty)/(sum(nrow(GroupQuarters_Poverty)+ nrow(NonGroupQuarters_Poverty)))*100
Percentage_NonGroupQuarters_Poverty = nrow(NonGroupQuarters_Poverty)/(sum(nrow(GroupQuarters_Poverty)+ nrow(NonGroupQuarters_Poverty)))*100
data2 <- rbind(data2, Percentage_GroupQuarters_Poverty)
data2 <- rbind(data2, Percentage_NonGroupQuarters_Poverty)
GroupQuartersFlag = c(1,0)
data2 <- cbind(data2, GroupQuartersFlag)
colnames(data2) <- c('Percentage', 'GroupQuartersFlag')

pie_chart <- ggplot(data2, aes(x = "", y = Percentage, fill = factor(GroupQuartersFlag))) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Percentage of Poverty in group quarters",
       fill = "GroupQuartersFlag") +
  scale_fill_manual(values = c("0" = "pink", "1" = "black"), labels = c("0", "1")) +
  theme_minimal() +
  theme(legend.position = "bottom")
print(pie_chart)

```

```{r }
t_test_result <- t.test(df_outliers$PovertyRate ~ df_outliers$GroupQuartersFlag)
t_test_result

```
p value is less than $\alpha$ (0.05).
Thus, Null hypothesis is rejected, indicating that there is a significant difference between the means

*Question 3.2:*

- Percentage of Group quarters by state:

```{r }
df$State <- as.factor(df$State)


bar_chart <- ggplot(df, aes(x = State, y = PCTGQTRS)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Percentage of Group Quarters by State",
       x = "State",
       y = "Percentage of Group Quarters") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=1))  

print(bar_chart)
```

*Question 3.3:*

- correlation between the percentage of group quarters and the prevalence of food deserts?

chi-square (GOF) between GroupQuartersFlag and LILATracts_1And10

Null Hypothesis (H0): The observed data follows the expected distribution (i.e., there is no significant difference between observed and expected frequencies).

Alternative Hypothesis (H1): The observed data does not follow the expected distribution (i.e., there is a significant difference between observed and expected frequencies).


```{r}
contingency_table <- table(df$GroupQuartersFlag, df$LILATracts_1And10)
contingency_table

chi_squared_test_result <- chisq.test(contingency_table)
chi_squared_test_result

chi_squared_test_result$expected

```
p value is very low, thus H0 reject. This indicates that the observed data does not follow the expected distribution, and there is a significant difference between observed and expected frequencies for the "GroupQuartersFlag" and "LILATracts_1And10" variables.


The low p-value suggests a significant difference between the "GroupQuartersFlag" and "LILATracts_1And10" variables. This means that there is an association or relationship between these variables.


*Question 9.1: *

- Different Demographic groups in Food deserted Tracts:

Total white -> Tract white
White more than 1 mile -> lawhite1
Urban

% = lawhite1 urban =1, lila_tracts = 1 + lawhite10 urban =0, lila_tracts = 1/ Tract white, lila_tracts = 1


```{r}
LILA_df <- df[df$LILATracts_1And10 == 1,]
LILA_Urban <- LILA_df[LILA_df$Urban == 1,]
LILA_Rural <- LILA_df[LILA_df$Urban == 0,]

Percentage_LILA_White <- ((sum(LILA_Urban$lawhite1) + sum(LILA_Rural$lawhite10))/sum(df$TractWhite))*100
Percentage_LILA_Black <- ((sum(LILA_Urban$lablack1) + sum(LILA_Rural$lablack10))/sum(df$TractBlack))*100
Percentage_LILA_Asian <- ((sum(LILA_Urban$laasian1) + sum(LILA_Rural$laasian10))/sum(df$TractAsian))*100
Percentage_LILA_Hisp <- ((sum(LILA_Urban$lahisp1) + sum(LILA_Rural$lahisp10))/sum(df$TractHispanic))*100
Percentage_LILA_Hopi <- ((sum(LILA_Urban$lanhopi1) + sum(LILA_Rural$lanhopi10))/sum(df$TractNHOPI))*100
Percentage_LILA_Multir <- ((sum(LILA_Urban$laomultir1) + sum(LILA_Rural$laomultir10))/sum(df$TractOMultir))*100
Percentage_LILA_Aian <- ((sum(LILA_Urban$laaian1) + sum(LILA_Rural$laaian10))/sum(df$TractAIAN))*100

data3 = data.frame()
data3 <- rbind(data3, Percentage_LILA_White)
data3 <- rbind(data3, Percentage_LILA_Black)
data3 <- rbind(data3, Percentage_LILA_Asian)
data3 <- rbind(data3, Percentage_LILA_Hisp)
data3 <- rbind(data3, Percentage_LILA_Hopi)
data3 <- rbind(data3, Percentage_LILA_Multir)
data3 <- rbind(data3, Percentage_LILA_Aian)
Groups = c("White", "Black", "Asian", "Hisp", "Hopi", "OMultir", "Aian")
data3 <- cbind(data3, Groups)
colnames(data3) <- c('Percentage', 'Groups')

```

```{r}


bar_chart <- ggplot(data3, aes(x = Groups, y = Percentage)) +
  geom_bar(stat = "identity", fill = "navy") +
  labs(title = "Percentage of each demographic groups by Food deserts",
       x = "Demographic Groups",
       y = "Percentage") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=1))  

print(bar_chart)

```
Hopi - Native Hawaiian or Other Pacific Islander
OMultir - other/multiple race
Hisp - Hispanic or Latino
Aian - American Indian or Alaska Native.


- Box plot among demographic groups:



```{r}
ggplot(data3, aes(x=Groups, y=Percentage)) + 
  geom_boxplot( colour=c("#ff0000","#11cc11","#0000ff","#ff00ff", "#ff0000","#11cc11","#0000ff"), outlier.shape=8, outlier.size=7) +
  labs(title="GPA marks for applicants with different ranks", x="rank", y = "GPA marks")

```



*Question 9.3*

 - pie chart of kids in food deserts and non food deserts.

More population of Kids are in Food deserted area.

Null Hypothesis (H0): The mean population of kids in food deserts (LILA_Tractsflag = 1) is equal to the mean population of kids in non-food deserts (LILA_Tractsflag = 0).

Alternative Hypothesis (H1): The mean population of kids in food deserts is not equal to the mean population of kids in non-food deserts.


```{r}
LILA_df <- df[df$LILATracts_1And10 == 1,]
LILA_Urban <- LILA_df[LILA_df$Urban == 1,]
LILA_Rural <- LILA_df[LILA_df$Urban == 0,]

Percentage_LILA_kids <- ((sum(LILA_Urban$lakids1) + sum(LILA_Rural$lakids10))/sum(df$TractKids))*100

NonLILA_df <- df[df$LILATracts_1And10 == 0,]
NonLILA_Urban <- NonLILA_df[NonLILA_df$Urban == 1,]
NonLILA_Rural <- NonLILA_df[NonLILA_df$Urban == 0,]

Percentage_NonLILA_kids <- ((sum(NonLILA_Urban$lakids1) + sum(NonLILA_Rural$lakids10))/sum(df$TractKids))*100


data5 = data.frame()
data5 <- rbind(data5, Percentage_LILA_kids)
data5 <- rbind(data5, Percentage_NonLILA_kids)

LILA = c(1,0)
data5 <- cbind(data5, LILA)
colnames(data5) <- c('Percentage', 'LILA')

pie_chart <- ggplot(data5, aes(x = "", y = Percentage, fill = factor(LILA))) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Percentage of Kids in Food desert regions",
       fill = "Food desert regions") +
  scale_fill_manual(values = c("0" = "#5b84c4", "1" = "#F98125"), labels = c("0", "1")) +
  theme_minimal() +
  theme(legend.position = "bottom")
print(pie_chart)

```
```{r }
t_test_result <- t.test(LILA_df$TractKids,NonLILA_df$TractKids)
t_test_result

```
p < 0.05, thus null rejected. mean population of kids in food deserts is not equal to the mean population of kids in non-food deserts.



 - pie chart of Seniors in food deserts and non food deserts.


Null Hypothesis (H0): The mean population of Seniors in food deserts (LILA_Tractsflag = 1) is equal to the mean population of Seniors in non-food deserts (LILA_Tractsflag = 0).

Alternative Hypothesis (H1): The mean population of Seniors in food deserts is not equal to the mean population of Seniors in non-food deserts.


```{r}

Percentage_LILA_Seniors <- ((sum(LILA_Urban$laseniors1) + sum(LILA_Rural$laseniors10))/sum(df$TractSeniors))*100

Percentage_NonLILA_Seniors <- ((sum(NonLILA_Urban$laseniors1) + sum(NonLILA_Rural$laseniors10))/sum(df$TractSeniors))*100


data6 = data.frame()
data6 <- rbind(data6, Percentage_LILA_Seniors)
data6 <- rbind(data6, Percentage_NonLILA_Seniors)

LILA = c(1,0)
data6 <- cbind(data6, LILA)
colnames(data6) <- c('Percentage', 'LILA')

pie_chart <- ggplot(data6, aes(x = "", y = Percentage, fill = factor(LILA))) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Percentage of Seniors in Food desert regions",
       fill = "Food desert regions") +
  scale_fill_manual(values = c("0" = "#F54F52", "1" = "#93F03B"), labels = c("0", "1")) +
  theme_minimal() +
  theme(legend.position = "bottom")
print(pie_chart)

```

```{r }
t_test_result <- t.test(LILA_df$TractSeniors,NonLILA_df$TractSeniors)
t_test_result

```

p < 0.05, thus null rejected. mean population of Seniors in food deserts is not equal to the mean population of kids in non-food deserts.


```{r }
df2010 = data.frame(read.csv("D:/Keerthu/GW/IntroToDataScience_6101/Project/Data_sets/Food_Deserts_in_US_2010.csv"))
head(df2010)
```

*Question 10*


- Population difference in 2010 and 2015 in states.

```{r }
df2010$State_name <- as.factor(df2010$State_name)

LILA_df2010 <- df2010[df2010$LILATracts_1And10 == 1, c("POP2010", "State_name")]
LILA_df2015 <- df[df$LILATracts_1And10 == 1, c("POP2010", "State")]
colnames(LILA_df2015) <- c("POP2015", "State")
colnames(LILA_df2010) <- c("POP2010", "State")
```

Sum of population in food desert in 2010 - `r sum(LILA_df2010$POP2010)`
Sum of population in food desert in 2015 - `r sum(LILA_df2015$POP2010)`


```{r}
library(dplyr)

summed_df_2015 <- LILA_df2015 %>% 
  group_by(State) %>% 
  summarise(POP2015 = sum(POP2015))

summed_df_2010 <- LILA_df2010 %>% 
  group_by(State) %>% 
  summarise(POP2010 = sum(POP2010))

merged_df <- full_join(summed_df_2015, summed_df_2010, by = "State")
# ohio <- merged_df[merged_df$State == "Ohio", ]
# sum(ohio$POP2015)

merged_df$PopulationDifference <- merged_df$POP2015 - merged_df$POP2010

```

```{r}

# Create a bar chart
library(ggplot2)
p <- ggplot(merged_df, aes(x = State)) +
  geom_bar(aes(y = POP2015, fill = "2015"), stat = "identity", position = "dodge") +
  geom_bar(aes(y = POP2010, fill = "2010"), stat = "identity", position = "dodge") +
  labs(y = "Population", fill = "Year") +
  scale_fill_manual(values = c("2010" = "gold", "2015" = "black")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=0.2))

options(
  repr.plot.width = 25,  # Set the desired width in inches
  repr.plot.height = 4  # Set the desired height in inches
)

print(p)
  
```


- Population change in Food deserts from 2010 to 2015:


```{r }

bar_chart <- ggplot(merged_df, aes(x = State, y = PopulationDifference)) +
  geom_bar(stat = "identity", fill = "lightblue", width = 0.5) +
  labs(title = "Population change in Food quarters by State",
       x = "State",
       y = "Percentage change") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=0.2))  

options(
  repr.plot.width = 25,  # Set the desired width in inches
  repr.plot.height = 4  # Set the desired height in inches
)

print(bar_chart)
```


ANOVA Test just if present.


```{r}
# anovaRes_pop = aov(PopulationDifference ~ State, data=df_out)
# # anovaRes    # this does not give the easy-to-read result of the aov analysis
# #names(anovaRes_gre)
# anovaRes_pop_summary = summary(anovaRes_pop)
# xkabledply(anovaRes_pop)
```

```{r tukeyHSD_gre}
# tukeyAoV_pop <- TukeyHSD(anovaRes_pop)
# tukeyAoV_pop
```

```{r}
library(usmap)

merged_dff <- merged_df[merged_df$State != "District of Columbia",]
merged_dff <- merged_dff[order(merged_dff$State),]
map_df <- data.frame(
  state = state.name,
  diff = merged_dff$PopulationDifference)

# usmap::us_map(map_df, values = "PopulationDifference", lines = "black", labels = TRUE) +
#   scale_fill_continuous(
#     name = "Population Difference",
#     low = "red",
#     high = "green",
#     labels = scales::comma
#   ) +
#   labs(title = "Population Difference State-Wise")

plot_usmap(data = map_df, values = "diff", labels = FALSE)
 

```






